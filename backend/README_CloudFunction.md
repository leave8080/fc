# è‡ªå®ç°äº‘å‡½æ•°å¹³å°

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªè‡ªå·±å®ç°çš„äº‘å‡½æ•°å¹³å°ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€è¿è¡Œæ—¶ï¼Œæä¾›å®Œæ•´çš„å‡½æ•°ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹äº‘æœåŠ¡å•†ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ å¤šè¿è¡Œæ—¶æ”¯æŒ
- **Go**: åŸç”Ÿæ”¯æŒï¼Œç¼–è¯‘æ‰§è¡Œ
- **Node.js**: JavaScript/TypeScriptæ”¯æŒ
- **Python**: Python3æ”¯æŒ

### ğŸ”§ å®Œæ•´çš„å‡½æ•°ç®¡ç†
- âœ… åˆ›å»ºå‡½æ•°
- âœ… æ›´æ–°å‡½æ•°
- âœ… åˆ é™¤å‡½æ•°
- âœ… åˆ—å‡ºå‡½æ•°
- âœ… å‡½æ•°æ‰§è¡Œ
- âœ… å®æ—¶ç›‘æ§

### ğŸ›¡ï¸ å®‰å…¨ä¸éš”ç¦»
- å‡½æ•°æ²™ç›’ç¯å¢ƒ
- è¶…æ—¶æ§åˆ¶
- å†…å­˜é™åˆ¶
- è¿›ç¨‹éš”ç¦»

### ğŸ“Š æ€§èƒ½ç›‘æ§
- æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- å†…å­˜ä½¿ç”¨ç›‘æ§
- é”™è¯¯æ—¥å¿—è®°å½•

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend UI   â”‚    â”‚  HTTP API       â”‚    â”‚  Function       â”‚
â”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚â—„â”€â”€â–ºâ”‚  Platform       â”‚
â”‚ Vue.js + Axios  â”‚    â”‚ Gin Router      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                 â”‚                 â”‚                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Go Executor â”‚   â”‚ Node.js     â”‚   â”‚ Python      â”‚
                â”‚             â”‚   â”‚ Executor    â”‚   â”‚ Executor    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

**å¿…éœ€**:
- Go 1.16+ (å¿…é¡»)
- Git

**å¯é€‰**:
- Node.js 14+ (è¿è¡ŒNode.jså‡½æ•°)
- Python 3.7+ (è¿è¡ŒPythonå‡½æ•°)

### 2. å¯åŠ¨æœåŠ¡

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./start_cloudfunction.sh

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
go mod tidy
go run main.go
```

### 3. éªŒè¯æœåŠ¡

è®¿é—®å¥åº·æ£€æŸ¥æ¥å£ï¼š
```bash
curl http://localhost:8080/api/health
```

é¢„æœŸå“åº”ï¼š
```json
{
  "status": "ok",
  "services": {
    "crawler": "running",
    "cloudfunction": "running"
  }
}
```

## APIæ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:8080/api/v1`
- **Content-Type**: `application/json`

### å‡½æ•°ç®¡ç†API

#### 1. åˆ›å»ºå‡½æ•°
```http
POST /functions
Content-Type: application/json

{
  "name": "hello-world",
  "runtime": "go",
  "handler": "handler",
  "code": "func handler(event interface{}, context map[string]string) interface{} {\n    return map[string]interface{}{\n        \"message\": \"Hello World!\"\n    }\n}",
  "timeout": 30,
  "memory": 128,
  "environment": {
    "KEY": "value"
  }
}
```

#### 2. åˆ—å‡ºå‡½æ•°
```http
GET /functions
```

#### 3. è·å–å‡½æ•°è¯¦æƒ…
```http
GET /functions/{id}
```

#### 4. æ›´æ–°å‡½æ•°
```http
PUT /functions/{id}
Content-Type: application/json

{
  "name": "updated-hello",
  "timeout": 60
}
```

#### 5. åˆ é™¤å‡½æ•°
```http
DELETE /functions/{id}
```

#### 6. æ‰§è¡Œå‡½æ•°
```http
POST /functions/{id}/invoke
Content-Type: application/json

{
  "event": {
    "message": "Hello World",
    "data": [1, 2, 3]
  },
  "context": {
    "user_id": "123",
    "request_id": "req_456"
  }
}
```

## å‡½æ•°ç¼–å†™æŒ‡å—

### Goå‡½æ•°

```go
// åŸºæœ¬æ ¼å¼
func handler(event interface{}, context map[string]string) interface{} {
    // ä½ çš„ä¸šåŠ¡é€»è¾‘
    return result
}

// ç¤ºä¾‹ï¼šæ•°æ®å¤„ç†
func processData(event interface{}, context map[string]string) interface{} {
    eventMap := event.(map[string]interface{})
    data := eventMap["data"].([]interface{})
    
    sum := 0.0
    for _, v := range data {
        sum += v.(float64)
    }
    
    return map[string]interface{}{
        "sum": sum,
        "count": len(data),
        "average": sum / float64(len(data)),
    }
}
```

### Node.jså‡½æ•°

```javascript
// åŒæ­¥å‡½æ•°
function handler(event, context) {
    return {
        message: "Hello from Node.js",
        event: event
    };
}

// å¼‚æ­¥å‡½æ•°
async function fetchData(event, context) {
    const axios = require('axios');
    
    try {
        const response = await axios.get('https://api.example.com/data');
        return {
            success: true,
            data: response.data
        };
    } catch (error) {
        return {
            success: false,
            error: error.message
        };
    }
}
```

### Pythonå‡½æ•°

```python
# åŸºæœ¬å‡½æ•°
def handler(event, context):
    return {
        'message': 'Hello from Python',
        'event': event
    }

# æ•°æ®åˆ†æå‡½æ•°
def analyze_data(event, context):
    import statistics
    
    data = event.get('data', [])
    
    if not data:
        return {'error': 'No data provided'}
    
    return {
        'mean': statistics.mean(data),
        'median': statistics.median(data),
        'mode': statistics.mode(data),
        'stdev': statistics.stdev(data)
    }
```

## å‰ç«¯ç®¡ç†ç•Œé¢

è®¿é—® `http://localhost:3000` (éœ€è¦å¯åŠ¨å‰ç«¯æœåŠ¡)

### åŠŸèƒ½ç‰¹æ€§
- ğŸ“ å¯è§†åŒ–å‡½æ•°ç¼–è¾‘å™¨
- ğŸ¯ ä¸€é”®å‡½æ•°æµ‹è¯•
- ğŸ“‹ å‡½æ•°åˆ—è¡¨ç®¡ç†
- ğŸ”„ å®æ—¶æ‰§è¡Œç»“æœ
- ğŸ“Š æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

## æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•
```bash
# å¯åŠ¨æœåŠ¡å™¨ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
./start_cloudfunction.sh

# è¿è¡Œæµ‹è¯•
cd test
go run cloudfunction_test.go
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
# åˆ›å»ºæµ‹è¯•å‡½æ•°
curl -X POST http://localhost:8080/api/v1/functions \
  -H "Content-Type: application/json" \
  -d '{
    "name": "test-hello",
    "runtime": "go",
    "handler": "handler",
    "code": "func handler(event interface{}, context map[string]string) interface{} {\n    return map[string]interface{}{\n        \"message\": \"Hello World!\",\n        \"event\": event\n    }\n}"
  }'

# è°ƒç”¨å‡½æ•°ï¼ˆæ›¿æ¢{id}ä¸ºå®é™…å‡½æ•°IDï¼‰
curl -X POST http://localhost:8080/api/v1/functions/{id}/invoke \
  -H "Content-Type: application/json" \
  -d '{
    "event": {"test": "data"},
    "context": {"user": "test"}
  }'
```

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
- `CLOUDFUNCTION_PORT`: æœåŠ¡ç«¯å£ (é»˜è®¤: 8080)
- `CLOUDFUNCTION_WORKDIR`: å‡½æ•°å·¥ä½œç›®å½• (é»˜è®¤: ./functions)
- `CLOUDFUNCTION_TIMEOUT`: é»˜è®¤è¶…æ—¶æ—¶é—´ (é»˜è®¤: 30ç§’)

### å®‰å…¨é…ç½®
- å‡½æ•°æ‰§è¡Œè¶…æ—¶é™åˆ¶
- å†…å­˜ä½¿ç”¨é™åˆ¶
- è¿›ç¨‹éš”ç¦»
- ç¦æ­¢è®¿é—®ç³»ç»Ÿæ•æ„Ÿç›®å½•

## ç›‘æ§å’Œæ—¥å¿—

### æ‰§è¡Œæ—¥å¿—
æ‰€æœ‰å‡½æ•°æ‰§è¡Œéƒ½ä¼šè®°å½•ï¼š
- å¼€å§‹æ—¶é—´
- æ‰§è¡Œæ—¶é•¿
- å†…å­˜ä½¿ç”¨
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- é”™è¯¯ä¿¡æ¯

### æ€§èƒ½ç›‘æ§
- å¹³å‡æ‰§è¡Œæ—¶é—´
- æˆåŠŸç‡ç»Ÿè®¡
- é”™è¯¯ç±»å‹åˆ†æ

## éƒ¨ç½²

### Dockeréƒ¨ç½²
```dockerfile
FROM golang:1.19-alpine AS builder
WORKDIR /app
COPY . .
RUN go mod tidy && go build -o cloudfunction main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates nodejs python3
WORKDIR /root/
COPY --from=builder /app/cloudfunction .
EXPOSE 8080
CMD ["./cloudfunction"]
```

### Kuberneteséƒ¨ç½²
å‚è€ƒ `k8s-manifests.yaml` æ–‡ä»¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å‡½æ•°ç¼–è¯‘å¤±è´¥**
   - æ£€æŸ¥ä»£ç è¯­æ³•
   - ç¡®è®¤è¿è¡Œæ—¶å·²å®‰è£…
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **å‡½æ•°æ‰§è¡Œè¶…æ—¶**
   - è°ƒæ•´è¶…æ—¶æ—¶é—´
   - ä¼˜åŒ–å‡½æ•°ä»£ç 
   - æ£€æŸ¥ç½‘ç»œä¾èµ–

3. **å†…å­˜ä¸è¶³**
   - å¢åŠ å†…å­˜é™åˆ¶
   - ä¼˜åŒ–å†…å­˜ä½¿ç”¨
   - é¿å…å†…å­˜æ³„æ¼

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u cloudfunction -f

# æŸ¥çœ‹å‡½æ•°æ‰§è¡Œæ—¥å¿—
tail -f functions/*/logs/*.log
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°è¿è¡Œæ—¶
1. åœ¨ `executors.go` ä¸­æ·»åŠ æ–°çš„æ‰§è¡Œå™¨
2. æ›´æ–° `platform.go` ä¸­çš„è¿è¡Œæ—¶åˆ¤æ–­
3. æ·»åŠ å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹

### è‡ªå®šä¹‰ä¸­é—´ä»¶
```go
func customMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        // è‡ªå®šä¹‰é€»è¾‘
        c.Next()
    }
}
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤è€…ã€‚ 